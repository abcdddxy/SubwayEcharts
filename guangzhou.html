<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">  
    <title>Subway Data</title>
    <meta name="description" content="">
    <meta name="author" content="templatemo">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300,400italic,700' rel='stylesheet' type='text/css'>
    <link href="css/font-awesome.min.css" rel="stylesheet">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/templatemo-style.css" rel="stylesheet">
    
    <style>
        .templatemo-site-header{height:27px}
        .subways{margin-right: 15px;
                 margin-top: 16px}
    </style>
  </head>
  <body>
    <!-- Left column -->
    <div class="templatemo-flex-row">
      <div class="templatemo-sidebar">
        <header class="templatemo-site-header">
          <i class="fa fa-subway fa-2x" aria-hidden="true" style="color:white;margin-right:20px"></i><h1 style="margin-bottom:15px">SUBWAY</h1>
        </header>
        <div class="profile-photo-container">
          <img src="images/bg.jpeg" alt="Profile Photo" class="img-responsive">  
          <div class="profile-photo-overlay"></div>
        </div>      
        <!-- Search box -->
        <form class="templatemo-search-form" role="search">
          <div class="input-group">
              <button type="submit" class="fa fa-search"></button>
              <input type="text" class="form-control" placeholder="Search" name="srch-term" id="srch-term">           
          </div>
        </form>
        <div class="mobile-menu-icon">
            <i class="fa fa-bars"></i>
        </div>
        <nav class="templatemo-left-nav">          
          <ul>
            <li><a href="guangzhou.html" class="active"><i class="fa fa-home fa-fw fa-lg"></i>主页</a></li>
            <li><a href="g-inandout.html"><i class="fa fa-area-chart fa-lg"></i>进出站客流趋势</a></li>
            <li><a href="g-stations.html"><i class="fa fa-bar-chart fa-lg"></i>进出站客流对比</a></li>
            <li><a href="g-lines.html"><i class="fa fa-line-chart fa-lg"></i>地铁线路日客流</a></li>
            <li><a href="g-startend.html"><i class="fa fa-dot-circle-o fa-lg"></i>起终点客流分析</a></li>       
            <li><a href="g-hotstation.html"><i class="fa fa-fire fa-lg"></i>热门站点及线路展示</a></li>    
            <li><a href="g-ticket.html"><i class="fa fa-pie-chart fa-lg"></i>购票方式</a></li>           
            <li><a href="g-routes.html"><i class="fa fa-street-view fa-lg"></i>乘客群体画像</a></li>
            <li><a href="index.html" target="_blank"><i class="fa fa-clock-o fa-lg" ></i>实时客流预警</a></li>
            <li><a href="mailto:somebody@qq.com"><i class="fa fa-envelope fa-lg"></i>联系我们</a></li>
          </ul>  
        </nav>
      </div>
        
      <!-- Main content --> 
      <div class="templatemo-content col-1" style="background:#2F4F4F">
        <div class="templatemo-top-nav-container">
          <div class="row">
            <nav class="templatemo-top-nav col-lg-6 col-md-12">
                  <ul class="text-uppercase">
                    <li><a href="guangzhou.html" class="active">广州</a></li>
                    <li><a href="changsha.html">长沙</a></li>
                 </ul>
            </nav>
                 <ul class="nav navbar-top-links navbar-right">
                    <a href="#"><i class="fa fa-facebook-official fa-lg" aria-hidden="true" style="margin-right:20px;color:black"></i></a>
                    <a href="#"><i class="fa fa-twitter-square fa-lg" aria-hidden="true" style="margin-right:20px;color:black"></i></a>
                    <a href="#"><i class="fa fa-wechat fa-lg" aria-hidden="true" style="margin-right:20px;color:black"></i></a>
                    <a href="#"><i class="fa fa-weibo fa-lg" aria-hidden="true" style="margin-right:20px;color:black"></i></a>
                 </ul>
          </div>
        </div>
        <div class="templatemo-content-container">
           <div>
            <h1 style="color:white">Subway Data</h1><br/><hr> 
           </div>
           <div class="col-md-12" style="margin-top:16px;margin-bottom:40px">
                 <div class="row"> 
                  <div class="templatemo-content-widget orange-bg col-md-6">
                    <i class="fa fa-times"></i>                
                    <div class="media">
                      <div class="media-left">
                          <img class="media-object img-circle" src="images/subway.jpg">
                      </div>
                      <div class="media-body">
                        <h2 class="media-heading text-uppercase">广州地铁大数据</h2>
                        <p>随着广州地铁跨越式的发展，广州地铁进入了大线网运营时代，客流快速增长，目前日均客流超680万人次，最高日客运量达到900万人次，承担了广州市超过44%的公交客流运送任务，客流强度全国第一。</p>  
                      </div>        
                    </div>                
                  </div>
                  <div class="templatemo-content-widget blue-bg col-md-5" style="float:right">
                    <i class="fa fa-times"></i>                
                    <div class="media">
                      <div class="media-body">
                        <h2 class="media-heading text-uppercase">More Information</h2>
                        <a href="http://www.gzmtr.com/" target="_blank"><img class="subways" src="images/guangzhou.jpg"></a>
                        <a href="http://www.bjsubway.com/" target="_blank"><img class="subways" src="images/bj.jpg"></a>
                        <a href="http://www.shmetro.com/" target="_blank"><img class="subways" src="images/sh.jpg"></a>
                        <a href="http://www.szmc.net/" target="_blank"><img class="subways" src="images/sz.jpg"></a>
                        <a href="http://www.hncsmtr.com/" target="_blank"><img class="subways" src="images/changsha.jpg"></a>
                        <a href="http://www.mtr.com.hk/ch/customer/main/index.html" target="_blank"><img class="subways" src="images/hk.jpg"></a>
                      </div>        
                    </div>                
                  </div>   
                 </div>
                 <div class="row">
                 <div class="templatemo-flex-row flex-content-row templatemo-overflow-hidden">
                    <div class="col-1 templatemo-overflow-hidden">
                      <div class="templatemo-content-widget white-bg templatemo-overflow-hidden">
                        <i class="fa fa-times"></i>
                        <div class="templatemo-flex-row flex-content-row">
                          <div class="col-1 col-lg-6 col-md-6">
                            <h2 class="text-center">购票方式<span class="badge">new</span></h2><hr>
                            <div id="first" style="height:350px"></div> <!-- Pie chart div -->
                          </div>
                          <div class="col-1 col-lg-6 col-md-6">
                            <h2 class="text-center">热门站点客流量分布<span class="badge">new</span></h2><hr>
                            <div id="second" style="height:350px"></div> <!-- Bar chart div -->
                          </div>  
                        </div>
<!--
                          <div class="col-md-12">
                             <p>以上数据均来源于xxx，如有问题，请及时与我们联系。</p>      
                          </div>
-->
                      </div>
                    </div>
                  </div>
                 </div>
           </div>
        </div>
        <center>
            <footer>
                <p style="color:white">Copyright &copy; 2084 Company Name 
                | Designed by <a href="http://www.templatemo.com" target="_parent">templatemo</a></p>
            </footer>         
        </center>
      </div>
    </div>
    <!-- JS -->
              
    <script src="js/jquery-1.11.2.min.js"></script>      <!-- jQuery -->
    <script src="js/jquery-migrate-1.2.1.min.js"></script> <!--  jQuery Migrate Plugin -->
    <script type="text/javascript" src="js/templatemo-script.js"></script>      <!-- Templatemo Script -->
    <script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
    <script src="http://libs.baidu.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
    <script src="js/echarts.js"></script>
    <script type="text/javascript">
          var firstChart = echarts.init(document.getElementById('first'));
          var secondChart = echarts.init(document.getElementById('second'));
          window.onresize = function () {firstChart.resize();secondChart.resize();}
          $.ajax({
                type: 'GET',
                url: 'http://10.108.122.213:5000/api/bought_method',
                dataType: 'jsonp', //希望服务器返回json格式的数据
                data:{  'city' : "广州", 
                        'month_start':'2017-3',
                        'month_end':'2017-03'   
                     },
                jsonp: "callback",
                jsonpCallback: "successCallback",//回调方法
                success: function (data) {
                    var color = ['#ffb980','#5ab1ef','#b6a2de','#2ec7c9','#8d98b3'];
                    var method = [];
                    var value = [];
                    var itemstyle = [];
                    for(var i = 0;i < data.data.length;i++)
                    {  
                        method.push(data.data[i].method);
                        value.push(data.data[i].UserCount);
                    }
                    for(var i=0;i<method.length;i++)
                        itemstyle[i] = {normal:{color:color[i]}};
                    var option = {
                            title: {
                                subtext: '三月广州地铁购票方式分布',
                                left: 'center',
                                top: '20px'
                            },
                            legend: {
                                x: 'center',
                                data: method
                            },
                            tooltip: {trigger:'item',
                                     formatter: "{b} : ({d}%)" },
                            series: [
                                {
                                    name: '购票方式分布',
                                    type: 'pie',
                                    selectedMode: 'single',
                                    radius: '30%',
                                    center: ['50%','60%'],
                                    label: function (params){if(params.percent > 0.1)
                                                             return{
                                                                    normal: {
                                                                    position: 'inner',
                                                                    textStyle: {color: '#00CED1'},
                                                                    formatter :  function(params){return (params.percent - 0).toFixed(0) + '%'} 
                                                                    }
                                                             }
                                                             else {return {show: false}}
                                    },
                                    labelLine: {normal: {show: false}},
                                    data: [
                                        {name: method[0], value: value[0], itemStyle: itemstyle[0]},
                                        {name: method[1], value: value[1], itemStyle: itemstyle[1]},
                                        {name: '客户端', value: value[2]+value[3]+value[4], itemStyle: itemstyle[3]}
                                    ],
                                    //z: 100,
                                    itemStyle:{ 
                                    normal:{ 
                                          label:{ 
                                            show: true, 
                                            formatter: '{b} : ({d}%)' 
                                                }, 
                                          labelLine :{show:true} 
                                           } 
                                    }
                                },
                                {
                                    name:'购票方式分布',
                                    type:'pie',
                                    radius: ['40%', '55%'],
                                    center: ['50%','60%'],
                                    data: [
                                        {name: method[0], value: value[0], itemStyle: itemstyle[0]},
                                        {name: method[1], value: value[1], itemStyle: itemstyle[1]},
                                        {name: method[2], value: value[2], itemStyle: itemstyle[2]},
                                        {name: method[3], value: value[3], itemStyle: itemstyle[3]},
                                        {name: method[4], value: value[4], itemStyle: itemstyle[4]} 
                                    ]
                                }
                            ]
                    };
                    firstChart.setOption(option);
                    $.ajax({
                        type: 'GET',
                        url: 'http://10.108.122.213:5000/api/multi_station_day',
                        dataType: 'jsonp', //希望服务器返回json格式的数据
                        data:{  'city' : "广州", 
                                'stations' : "广州东站+广州南站+广州火车站+体育中心+机场南",
                                'time_start' : "2017-03-08",
                                'time_end' : "2017-03-15"  
                             },
                        jsonp: "callback",
                        jsonpCallback: "successCallback",//回调方法
                        success: function (data) {
                            var fin = [];
                            var fout = [];
                            var ftotal = [];
                            var dates = ['2017-03-08','2017-03-09','2017-03-10','2017-03-11','2017-03-12','2017-03-13','2017-03-14','2017-03-15'];
                            var symbollist = ['emptycircle','triangle','diamond'];
                            var color = ['#2ec7c9','#ffb980','#ff715e'];
                            var itemstyle = [{normal:{color:color[0]}},
                                             {normal:{color:color[1]}},
                                             {normal:{color:color[2],label: {show: true}}}];
                             for(var j in data.data)
                                {   for(var i=0;i<8;i++)
                                    { fin.push((data.data[j][i].Fluency_in/1000).toFixed(1));//日期
                                      fout.push((data.data[j][i].Fluency_out/1000).toFixed(1));
                                      ftotal.push((data.data[j][i].Fluency_total/1000).toFixed(1));
                                    }
                                }
                             var option = {
                                 baseOption: {
                                                timeline: {
                                                    axisType: 'category',
                                                    symbol: 'emptycircle',
                                                    autoPlay: true,
                                                    playInterval: 1500,
                                                    data: [],
                                                    label: {
                                                        formatter : function(s) {
                                                            return (new Date(s)).getDate();
                                                        },
                                                        normal: {interval: 1}
                                                    },
                                                    checkpointStyle: {symbol: 'diamond',color: '#FF7F50'}
                                                },
                                                legend: {data:['进站客流','出站客流','客流总量']},
                                                tooltip: {trigger: 'axis',
                                                          axisPointer: {type: 'cross',}},
                                                calculable : true,
                                                grid: {
                                                    top: '25%',
                                                    bottom: '25%',
                                                    left: '15%'
                                                },
                                                xAxis: [
                                                    {
                                                        type:'category',
                                                        axisLabel:{'interval':0},
                                                        data:['广州东站','广州南站','广州火车站','体育中心','机场南'],
                                                        splitLine: {show: false},
                                                        boundaryGap : false
                                                    }],
                                                yAxis: [
                                                    {
                                                        type: 'value',
                                                        name: '（千人）'
                                                    }
                                                ],
                                                series: [{name:'进站客流',type:'line',smooth: true,symbol:symbollist[0],symbolSize:10,
                                                          lineStyle:{normal:{width:3}},itemStyle:itemstyle[0],stack:'总量',areaStyle: {normal: {}}
                                                         },
                                                         {name:'出站客流',type:'line',smooth: true,symbol:symbollist[1],symbolSize:10,
                                                          lineStyle:{normal:{width:3}},itemStyle:itemstyle[1],stack:'总量',areaStyle: {normal: {}}
                                                         },
                                                         {name:'客流总量',type:'line',smooth: true,symbol:symbollist[2],symbolSize:10,
                                                          lineStyle:{normal:{width:3}},itemStyle:itemstyle[2],stack:'总量',areaStyle: {normal: {}}
                                                         },
                                                ] 

                                 },
                                 options: []  
                             };
                             for (var n = 0; n < 8; n++) {
                                 var fin1 = [];
                                 var fout1 = [];
                                 var ftotal1 = [];
                                 for(var m = 0; m < 5; m++)
                                 {
                                  fin1.push(fin[m*8+n]);
                                  fout1.push(fout[m*8+n]);
                                  ftotal1.push(ftotal[m*8+n]);
                                 }
                                 option.baseOption.timeline.data.push(dates[n]);
                                 option.options.push({
                                    title: {
                                        show: true,
                                        subtext: dates[n] + '各主要站点客流分布',
                                        left: 'center'
                                    },
                                    series: [{data: fin1},
                                             {data: fout1},
                                             {data: ftotal1}]
                                });
                             }
                             secondChart.setOption(option);
                        }
                    });
                }
          });
    </script>
  </body>
</html>